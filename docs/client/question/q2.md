# 2、使用jquery、axios等工具访问云函数方式(云函数url化外部访问)
 
___必须开启云函数的URL化，假如URL地址为：https://xxx.bspapp.com/http/router___

开启URL化方法为：打开 `router/package.json` 文件，在 `path` 里填写 `/http/router`，最后重新上传云函数。

```js
cloudfunction-config": {
  "concurrency": 1,
  "memorySize": 256,
  "path": "/http/router",
  "timeout": 60,
  "triggers": [],
  "runtime": "Nodejs12"
}
```

如何获得云函数URL化的域名地址？

![](https://vkceyugu.cdn.bspapp.com/VKCEYUGU-cf0c5e69-620c-4f3c-84ab-f4619262939f/53ab9faf-4e28-4d5c-b735-2d7cee4a991e.png)

___注意：如果你直接在浏览器中访问url化地址，会触发下载请求，需要用 `postman` 等工具进行访问测试。___

## jquery ajax请求示例

jquery 方式1

```js
$.ajax({
  type: 'POST',
  url: "https://xxxxxx.com/http/router",
  data: JSON.stringify({
    $url: "template/test/pub/test",
    data: {
      a:1,
      b:"2"
    }
  }),
  success: (data) => {
    console.log("data", data);
  }
})
```

jquery 方式1 带token的示例

```js
$.ajax({
  type: 'POST',
  url: "https://xxxxxx.com/http/router",
  data: JSON.stringify({
    "uni_id_token": "用户token",  
    "$url": "template/test/pub/test",
    "data": {
      a:1,
      b:"2"
    }
  }),
  success: (data) => {
    console.log("data", data);
  }
})

```

jquery 方式2

```js
$.ajax({
  type: 'POST',
  url: "https://xxxxxx.com/http/router/template/test/pub/test",
  data:JSON.stringify({
    a:1,
    b:"2"
  }),
  success: (data) => {
    console.log("data", data);
  }
})
```

jquery 方式2 带token的示例

```js
$.ajax({
  type: 'POST',
  url: "https://xxxxxx.com/http/router/template/test/pub/test",
  data:JSON.stringify({
    uni_id_token:"用户token",
    a:1,
    b:"2"
  }),
  success: (data) => {
    console.log("data", data);
  }
})

```

## axios请求示例

axios 方式1

```js
axios.post('https://xxx.bspapp.com/http/router', {
  "$url":"user/pub/login",
  "data":{
    a:1,
    b:"2"
  }
})
.then(function (res) {
  console.log(res);
})
.catch(function (err) {
  console.log(err);
});
```

axios 方式1 带token的示例

```js
axios.post('https://xxx.bspapp.com/http/router', {
  "uni_id_token":"用户token",  
  "$url":"user/pub/login",
  "data":{
    a:1,
    b:"2"
  }
})
.then(function (res) {
  console.log(res);
})
.catch(function (err) {
  console.log(err);
});

```

axios 方式2

```js
axios.post('https://xxx.bspapp.com/http/router/user/pub/login', {
  a:1,
  b:"2"
})
.then(function (res) {
  console.log(res);
})
.catch(function (err) {
  console.log(err);
});
```

axios 方式2 带token的示例

```js
axios.post('https://xxx.bspapp.com/http/router/user/pub/login', {
  uni_id_token: "用户token",  
  a:1,
  b:"2"
})
.then(function (res) {
  console.log(res);
})
.catch(function (err) {
  console.log(err);
});

```

注意：部分接口若报如下错误

![](https://vkceyugu.cdn.bspapp.com/VKCEYUGU-cf0c5e69-620c-4f3c-84ab-f4619262939f/eb418f3f-7268-433f-9ca4-79f8902752c7.png)

则需要多传2个参数 `vk_appid` 和 `vk_platform`

其中 `vk_appid` 是 `manifest.json` 内的 `dc_appid`
`vk_platform` 是当前环境，如：`h5` `mp-weixin` `app-plus` 等

示例

```js
$.ajax({
  type: 'POST',
  url: "https://xxxxxx.com/http/router/template/test/pub/test",
  data: JSON.stringify({
    uni_id_token: "用户token",
    vk_appid: "你项目的appid",
    vk_platform: "h5",
    a: 1,
    b: "2"
  }),
  success: (data) => {
    console.log("data", data);
  }
})

```



